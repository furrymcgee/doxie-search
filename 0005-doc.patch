From 9feff7236cecd4865b0de3b536840edfc5b8566c Mon Sep 17 00:00:00 2001
From: Your Name <you@example.com>
Date: Fri, 26 Jul 2019 20:36:07 -0700
Subject: [PATCH 05/15] doc

---
 data/swish++.conf          | 4 +++-
 perl/Debian/Dwww/Common.pm | 4 ++++
 scripts/dwww-build-menu    | 4 ++++
 scripts/dwww-index++       | 7 ++++++-
 4 files changed, 17 insertions(+), 2 deletions(-)

diff --git a/data/swish++.conf b/data/swish++.conf
index 5ac8eff..d550e80 100644
--- a/data/swish++.conf
+++ b/data/swish++.conf
@@ -70,7 +70,9 @@ ExcludeFile		*.gif *.jpg *.png *.tar*
 FilterFile *.bz2	bunzip2 -c %f > @/var/cache/dwww/swish.tmp.%B
 FilterFile *.gz		gunzip -c %f > @/var/cache/dwww/swish.tmp.%B
 FilterFile *.Z		uncompress -c %f > @/var/cache/dwww/swish.tmp.%B
-#FilterFile *.doc	antiword %f @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.doc	antiword %f > @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.docx	docx2txt.pl %f @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.xlsx	xlsx2csv %f @/var/cache/dwww/swish.tmp.%B.txt
 FilterFile *.pdf	pdftotext %f @/var/cache/dwww/swish.tmp.%B.txt
 #FilterFile *.ps	pstotext %f > @/var/cache/dwww/swish.tmp.%B.txt
 
diff --git a/perl/Debian/Dwww/Common.pm b/perl/Debian/Dwww/Common.pm
index 071948a..09dd463 100644
--- a/perl/Debian/Dwww/Common.pm
+++ b/perl/Debian/Dwww/Common.pm
@@ -18,6 +18,8 @@ my %href  = # {{{
     (
         'debiandoc-sgml'=>   "$dwww_url#FILE#?type=application/sgml",
         'docbook-xml'   =>   "$dwww_url#FILE#?type=text/xml",
+        'doc'           =>   "$dwww_url#FILE#?type=application/msword",
+        'docx'           =>   "$dwww_url#FILE#?type=application/vnd.openxmlformats-officedocument.wordprocessingml.document",
         'dvi'           =>   "$dwww_url#FILE#?type=application/x-dvi",
         'html'          =>   "$dwww_url#FILE#?type=html",
         'info'          =>   "/cgi-bin/info2www?file=",
@@ -30,6 +32,8 @@ my %href  = # {{{
         'sgml'          =>   "$dwww_url#FILE#?type=application/sgml",
         'tar'           =>   "$dwww_url#FILE#?type=application/tar",
         'texinfo'       =>   "$dwww_url#FILE#?type=application/x-texinfo",
+        'xls'           =>   "$dwww_url#FILE#?type=application/vnd.ms-excel",
+        'xlsx'          =>   "$dwww_url#FILE#?type=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
         'dwww-url'      =>   "",
         'text'          =>   "$dwww_url#FILE#?type=text/plain",
         'pkgsearch'     =>   "$dwww_url?search=",
diff --git a/scripts/dwww-build-menu b/scripts/dwww-build-menu
index ed38ee1..81023c3 100755
--- a/scripts/dwww-build-menu
+++ b/scripts/dwww-build-menu
@@ -68,6 +68,10 @@ my @known_formats=(
     'rtf',
     'debiandoc-sgml',
     'docbook-xml',
+    'doc',
+    'docx',
+    'xls',
+    'xlsx',
     'dvi',
     'latex',
     'linuxdoc-sgml',
diff --git a/scripts/dwww-index++ b/scripts/dwww-index++
index 2780a21..f468a83 100755
--- a/scripts/dwww-index++
+++ b/scripts/dwww-index++
@@ -38,6 +38,11 @@ $| = 1;
 # Global variables
 my @index_formats=(
     'pdf',
+    'msg',
+    'xls',
+    'xlsx',
+    'doc',
+    'docx',
 	'html',
 	'text',
 	'rtf',
@@ -47,7 +52,7 @@ my @index_formats=(
 # files we never index, checked before stat() call
 my $stopfiles = qr(\.(css|dsl|ico|gif|jpe?g|lfig|mp[34]|sasl|png|svg)$)o;
 # files we actually index, after stat() call
-my $indexfiles = qr(\.([sx]?html?|te?xt?|pdf|rtf|[ja]sp|[1-9n][^\.]*)(\.gz|\.bz2|\.Z)?$)o;
+my $indexfiles = qr(\.([sx]?html?|te?xt?|doc|pdf|rtf|[ja]sp|[1-9n][^\.]*)(\.gz|\.bz2|\.Z)?$)o;
 
 my $dwww_url 				= "/cgi-bin/dwww";
 my $dwww_swish_conf   	  	= "/usr/share/dwww/swish++.conf";
-- 
2.23.0.rc1

