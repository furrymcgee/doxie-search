From bb4ce81b27f083d24b583f637da2343cdb7d7074 Mon Sep 17 00:00:00 2001
From: Your Name <you@example.com>
Date: Fri, 26 Jul 2019 10:11:31 -0700
Subject: [PATCH 04/15] pdf

---
 common.mk            | 2 +-
 data/Makefile        | 2 +-
 data/apache.conf     | 4 ++--
 data/swish++.conf    | 2 +-
 scripts/dwww-index++ | 3 ++-
 5 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/common.mk b/common.mk
index 996d5a5..dcdaa6f 100644
--- a/common.mk
+++ b/common.mk
@@ -17,7 +17,7 @@ install_link    := ln -sf
 compress        := gzip -9f
 
 prefix          := /usr
-etcdir          := /etc
+etcdir          := /etc/httpd/conf.d
 bindir          := $(prefix)/bin
 sbindir         := $(prefix)/sbin
 mandir          := $(prefix)/share/man
diff --git a/data/Makefile b/data/Makefile
index aa2612a..b7eea0a 100644
--- a/data/Makefile
+++ b/data/Makefile
@@ -12,5 +12,5 @@ all-local: $(generated) | $(bdir)
 
 install-local:
 	$(call install,$(pkgsharedir),$(templatefiles)) 
-	$(call install,$(etcdir)/apache2/conf-available/dwww.conf,apache.conf,notdir)
+	$(call install,$(etcdir)/dwww.conf,apache.conf,notdir)
 	$(call install,$(applicationsdir),dwww.desktop) 
diff --git a/data/apache.conf b/data/apache.conf
index 4172c9e..1c7ca3c 100644
--- a/data/apache.conf
+++ b/data/apache.conf
@@ -5,7 +5,7 @@
 
 <Directory "/srv/www/htdocs/dwww">
 	<IfModule mod_authz_host.c>
-		Require local
+		Require ip 192.168
 		# Require ip 192.0.2.0/24
 		# Require ip 2001:db8::a00:20ff:fea7:ccea/10
 	</IfModule>
@@ -13,7 +13,7 @@
 
 <Location "/cgi-bin/dwww">
 	<IfModule mod_authz_host.c>
-		Require local
+		Require ip 192.168
 		# Require ip 192.0.2.0/24
 		# Require ip 2001:db8::a00:20ff:fea7:ccea/10
 	</IfModule>
diff --git a/data/swish++.conf b/data/swish++.conf
index efcd615..5ac8eff 100644
--- a/data/swish++.conf
+++ b/data/swish++.conf
@@ -71,7 +71,7 @@ FilterFile *.bz2	bunzip2 -c %f > @/var/cache/dwww/swish.tmp.%B
 FilterFile *.gz		gunzip -c %f > @/var/cache/dwww/swish.tmp.%B
 FilterFile *.Z		uncompress -c %f > @/var/cache/dwww/swish.tmp.%B
 #FilterFile *.doc	antiword %f @/var/cache/dwww/swish.tmp.%B.txt
-#FilterFile *.pdf	pdftotext %f @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.pdf	pdftotext %f @/var/cache/dwww/swish.tmp.%B.txt
 #FilterFile *.ps	pstotext %f > @/var/cache/dwww/swish.tmp.%B.txt
 
 #
diff --git a/scripts/dwww-index++ b/scripts/dwww-index++
index c7143e2..2780a21 100755
--- a/scripts/dwww-index++
+++ b/scripts/dwww-index++
@@ -37,6 +37,7 @@ $| = 1;
 
 # Global variables
 my @index_formats=(
+    'pdf',
 	'html',
 	'text',
 	'rtf',
@@ -46,7 +47,7 @@ my @index_formats=(
 # files we never index, checked before stat() call
 my $stopfiles = qr(\.(css|dsl|ico|gif|jpe?g|lfig|mp[34]|sasl|png|svg)$)o;
 # files we actually index, after stat() call
-my $indexfiles = qr(\.([sx]?html?|te?xt?|rtf|[ja]sp|[1-9n][^\.]*)(\.gz|\.bz2|\.Z)?$)o;
+my $indexfiles = qr(\.([sx]?html?|te?xt?|pdf|rtf|[ja]sp|[1-9n][^\.]*)(\.gz|\.bz2|\.Z)?$)o;
 
 my $dwww_url 				= "/cgi-bin/dwww";
 my $dwww_swish_conf   	  	= "/usr/share/dwww/swish++.conf";
-- 
2.23.0.rc1

