From ecb17508ef4871e9640a5ad67274424eeff7cd17 Mon Sep 17 00:00:00 2001
From: furrymcgee <furrymcgee@lippydanger.jumpingcrab.com>
Date: Tue, 31 Mar 2020 08:36:27 +0200
Subject: [PATCH] index on (no branch): fa850df Bump version to 0.25.0

---
 .gitmodules                                   |  4 +-
 Makefile.am                                   |  3 +
 cygclass/dpkg.cygclass                        | 75 +++++++++++++++++++
 ...ample.cygport => cygport-0.25.0-1.cygport} |  3 +-
 .../build/data/gnuconfig                      |  1 +
 data/gnuconfig                                |  1 -
 doc/Makefile.am                               |  4 +-
 7 files changed, 85 insertions(+), 6 deletions(-)
 create mode 100644 cygclass/dpkg.cygclass
 rename data/{sample.cygport => cygport-0.25.0-1.cygport} (90%)
 create mode 160000 data/cygport-0.25.0-1.noarch/build/data/gnuconfig
 delete mode 160000 data/gnuconfig

diff --git cygport-0.25.0/.gitmodules cygport-0.25.0/.gitmodules
index 2a4c09d..2d596a0 100644
--- cygport-0.25.0/.gitmodules
+++ cygport-0.25.0/.gitmodules
@@ -1,3 +1,3 @@
-[submodule "data/gnuconfig"]
-	path = data/gnuconfig
+[submodule "data/cygport-0.25.0-1.noarch/build/data/gnuconfig"]
+	path = data/cygport-0.25.0-1.noarch/build/data/gnuconfig
 	url = git://git.sv.gnu.org/config.git
diff --git cygport-0.25.0/Makefile.am cygport-0.25.0/Makefile.am
index 2225293..1f3b9bd 100644
--- cygport-0.25.0/Makefile.am
+++ cygport-0.25.0/Makefile.am
@@ -21,6 +21,7 @@ EXTRA_DIST +=				\
 	cygport.spec			\
 	$(NULL)
 
+if HAVE_HELP2MAN
 dist-hook: doc/manual/cygport.1.html doc/manual/index.html
 	@if test -d "$(srcdir)/.git"; \
 	then \
@@ -35,3 +36,5 @@ dist-hook: doc/manual/cygport.1.html doc/manual/index.html
 		echo A git clone is required to generate a ChangeLog >&2; \
 	fi ; \
 	cp -r doc/manual/ $(top_distdir)/doc/
+else !HAVE_HELP2MAN
+endif !HAVE_HELP2MAN
diff --git cygport-0.25.0/cygclass/dpkg.cygclass cygport-0.25.0/cygclass/dpkg.cygclass
new file mode 100644
index 0000000..305fc4e
--- /dev/null
+++ cygport-0.25.0/cygclass/dpkg.cygclass
@@ -0,0 +1,75 @@
+################################################################################
+#
+# dpkg.cygclass - functions for building Debian packages
+#
+# Part of cygport - Cygwin packaging application
+# Copyright (C) 2006-2016 Yaakov Selkowitz
+# Provided by the Cygwin Ports project <http://sourceware.org/cygwinports/>
+#
+# cygport is free software: you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation, either version 3 of the License, or
+# (at your option) any later version.
+#
+# cygport is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with cygport.  If not, see <http://www.gnu.org/licenses/>.
+#
+################################################################################
+
+CYGPORT_USE_UNSTABLE_API=1
+
+# cross-compiling is not (yet?) supported
+__cross_compiling_error
+
+check_prog_req dpkg-source
+check_prog_req dpkg-buildpackage
+
+src_unpack_hook(){
+	find -mindepth 1 -maxdepth 1 -type d |
+	xargs -I@ rm -rf @
+
+	basename * |
+	PERL5LIB=/usr/share/perl5 \
+	xargs -I@ dpkg-source --extract "${top}/@" "${NAME}"
+}
+
+src_patch_hook(){
+	sed -i "${NAME}/debian/control" \
+		-e /Rules-Requires-Root/d \
+		-e /^Source:/,/^$/s/^\$/Rules-Requires-Root:\ no/ \
+		-e T\;G
+}
+
+#****o* dpkg.cygclass/src_compile (dpkg)
+#  DEFINITION
+src_compile() {
+	rsync --archive "${S}/." "${B}/." &&
+	cd -P "${B}/${NAME}" &&
+	# DEB_BUILD_OPTIONS="nocheck" \
+	PATH="$PWD/bin:$PATH" \
+	PERL5LIB="$PWD/lib:/usr/share/perl5" \
+	PERL_MM_OPT="INSTALLDIRS=vendor INSTALLVENDORLIB=/usr/share/perl5" \
+	dpkg-buildpackage -rnice -d -a i386 -t i686-pc-cygwin --source-option=--auto-commit
+}
+#****
+
+#****o* dpkg.cygclass/src_test (dpkg)
+#  DEFINITION
+src_test() {
+	cd -P "${B}"
+}
+#****
+
+#****o* dpkg.cygclass/src_install (dpkg)
+#  DEFINITION
+src_install() {
+	cd -P "${B}" &&
+	find -name \*.deb -exec dpkg -x {} "${D}" \;
+}
+#****
+
diff --git cygport-0.25.0/data/sample.cygport cygport-0.25.0/data/cygport-0.25.0-1.cygport
similarity index 90%
rename from data/sample.cygport
rename to data/cygport-0.25.0-1.cygport
index 8334e9e..6bd5a18 100644
--- cygport-0.25.0/data/sample.cygport
+++ cygport-0.25.0/data/cygport-0.25.0-1.cygport
@@ -6,7 +6,7 @@ SUMMARY="Cygwin source packaging tool"
 DESCRIPTION="cygport is the standard method for building and maintaining
 packages for the Cygwin distribution."
 HOMEPAGE="http://sourceware.org/cygwinports/"
-SRC_URI="https://github.com/cygwinports/cygport/${VERSION}/cygport-${VERSION}.tar.gz"
+SRC_URI="https://github.com/cygwinports/cygport/archive/0.25.0.tar.gz#/cygport-${VERSION}.tar.gz"
 
 # this package contains no compiled Cygwin binaries
 # REMOVE THE FOLLOWING LINE for packages which are to be compiled for each arch
@@ -14,6 +14,7 @@ ARCH=noarch
 
 # Build dependencies only
 DEPEND="groff help2man robodoc"
+
 # runtime deps to go in setup.hint, and note the escaped newline
 REQUIRES="autoconf automake binutils bzip2 coreutils diffstat diffutils \
 dos2unix findutils file gawk gcc-core gcc-g++ grep gzip lftp libtool lndir \
diff --git cygport-0.25.0/data/cygport-0.25.0-1.noarch/build/data/gnuconfig cygport-0.25.0/data/cygport-0.25.0-1.noarch/build/data/gnuconfig
new file mode 160000
index 0000000..5256817
--- /dev/null
+++ cygport-0.25.0/data/cygport-0.25.0-1.noarch/build/data/gnuconfig
@@ -0,0 +1 @@
+Subproject commit 5256817ace8493502ec88501a19e4051c2e220b0
diff --git cygport-0.25.0/data/gnuconfig cygport-0.25.0/data/gnuconfig
deleted file mode 160000
index ddf1db9..0000000
--- cygport-0.25.0/data/gnuconfig
+++ /dev/null
@@ -1 +0,0 @@
-Subproject commit ddf1db93f3dde9ffd9f13a2529001e20aaf527d3
diff --git cygport-0.25.0/doc/Makefile.am cygport-0.25.0/doc/Makefile.am
index 0e6ace3..e6b077f 100644
--- cygport-0.25.0/doc/Makefile.am
+++ cygport-0.25.0/doc/Makefile.am
@@ -1,9 +1,9 @@
+if HAVE_HELP2MAN
+
 noinst_DATA = doc/manual/cygport.1.html doc/manual/index.html
 
 man_MANS = doc/cygport.1
 
-if HAVE_HELP2MAN
-
 doc/cygport.1: bin/cygport-inplace $(top_srcdir)/lib/help.cygpart
 	$(AM_V_GEN)test -d doc || $(MKDIR_P) doc ; \
 	$(HELP2MAN) -o $@ --no-info --name="Cygwin source packaging tool" $<
-- 
2.20.1

